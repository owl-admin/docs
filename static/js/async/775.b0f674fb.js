"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["775"],{8073:function(e,n,r){r.r(n),r.d(n,{default:()=>i});var a=r(2676),s=r(453);function l(e){let n=Object.assign({h1:"h1",a:"a",blockquote:"blockquote",p:"p",h3:"h3",code:"code",pre:"pre",em:"em",h4:"h4"},(0,s.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.h1,{id:"excel-导入",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#excel-导入",children:"#"}),"Excel 导入"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"这里举例一种 Excel 导入的写法, 或许不是最佳实现, 仅作参考~"}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["数据量不大的情况下, 使用 ",(0,a.jsx)(n.a,{href:"https://aisuda.bce.baidu.com/amis/zh-CN/components/form/input-excel",rel:"noopener noreferrer",target:"_blank",children:"InputExcel"})," 也是个不错的主意~"]}),"\n"]}),"\n",(0,a.jsxs)(n.h3,{id:"在crud-的工具栏添加两个按钮",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#在crud-的工具栏添加两个按钮",children:"#"}),"在",(0,a.jsx)(n.code,{children:"CRUD"})," 的工具栏添加两个按钮"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"public function list(): Page\n{\n    $crud = $this->baseCRUD()\n        ->headerToolbar([\n            $this->createButton(true),\n			// 导入按钮\n            Components::make()->importAction(admin_url('xxx_records/import')),\n            // 模板下载按钮\n			Components::make()->downloadImportTemplate('template/XXX导入模板.xlsx'),\n            ...$this->baseHeaderToolBar(),\n        ])\n		// ....\n	}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["注意: 此处的 ",(0,a.jsx)(n.code,{children:"Components"})," 是自己封装的, 里面可以放一些常用的非基础组件, 并非框架自带~"]})}),"\n",(0,a.jsxs)(n.h4,{id:"导入按钮实现",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导入按钮实现",children:"#"}),"导入按钮实现"]}),"\n",(0,a.jsx)(n.p,{children:"这里实现了一个弹窗表单, 上传文件并提交~"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// 这里我封装到了一个单独的 class 中\n// 你也可以直接放到对应的 Controller , 或者是直接塞到 headerToolbar 里面, 随你高兴~\npublic function importAction($api)\n{\n    return amis()->DialogAction()->label('导入')->icon('fa fa-upload')->dialog(\n        amis()->Dialog()->title('导入')->body(\n            amis()->Form()->mode('normal')->api($api)->body([\n                amis()->FileControl()->name('file')->required(true)->drag(true),\n            ]),\n        )\n    );\n}\n"})}),"\n",(0,a.jsxs)(n.h4,{id:"模板下载按钮实现",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#模板下载按钮实现",children:"#"}),"模板下载按钮实现"]}),"\n",(0,a.jsx)(n.p,{children:"这里传入了文件地址, 通过跳转链接的方式, 让浏览者自动下载文件~"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["注: 这里我的模板文件路径为: ",(0,a.jsx)(n.code,{children:"/public/template/XXX导入模板.xlsx"})]})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"public function downloadImportTemplate($path)\n{\n    return amis()\n        ->UrlAction()\n        ->blank(true)\n        ->label('下载模板')\n        ->icon('fa fa-download')\n        ->url(url($path));\n}\n"})}),"\n",(0,a.jsxs)(n.h3,{id:"实现导入接口",children:[(0,a.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#实现导入接口",children:"#"}),"实现导入接口"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// file: app/Admin/routes.php\n// 添加一个路由\n$router->post('xxx_records/import', [\\App\\Admin\\Controllers\\XXXRecordController::class, 'import']);\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-php",children:"// 控制器中实现导入数据\npublic function import(Request $request)\n{\n    $file = storage_path('app/public/' . $request->input('file'));\n\n    $data = fastexcel()->import($file);\n    \n    XXXRecord::insert($data->toArray());\n\n    return $this->response()->successMessage('导入成功');\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["注: 此处使用 ",(0,a.jsx)(n.a,{href:"https://github.com/rap2hpoutre/fast-excel",rel:"noopener noreferrer",target:"_blank",children:"fast-excel"})," 实现了最基础的数据导入, 其他逻辑自行添加~"]})})]})}function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,a.jsx)(n,Object.assign({},e,{children:(0,a.jsx)(l,e)})):l(e)}let i=t;t.__RSPRESS_PAGE_META={},t.__RSPRESS_PAGE_META["guide%2Fexamples%2Fexcel-import.md"]={toc:[{id:"在crud-的工具栏添加两个按钮",text:"在`CRUD` 的工具栏添加两个按钮",depth:3},{id:"导入按钮实现",text:"导入按钮实现",depth:4},{id:"模板下载按钮实现",text:"模板下载按钮实现",depth:4},{id:"实现导入接口",text:"实现导入接口",depth:3}],title:"Excel 导入",headingTitle:"Excel 导入",frontmatter:{}}}}]);