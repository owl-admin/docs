"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["4525"],{8136:function(e,n,i){i.r(n),i.d(n,{default:function(){return c}});var s=i(2676),l=i(453);function r(e){let n=Object.assign({h1:"h1",a:"a",h3:"h3",ul:"ul",li:"li",code:"code",p:"p",strong:"strong",pre:"pre"},(0,l.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"动态-api",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#动态-api",children:"#"}),"动态 API"]}),"\n",(0,s.jsxs)(n.h3,{id:"使用",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用",children:"#"}),"使用"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["使用场景","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"零代码实现某些简单的接口"}),"\n",(0,s.jsxs)(n.li,{children:["如: 从某个表查询 ",(0,s.jsx)(n.code,{children:"options"})," 列表, 配合 ",(0,s.jsx)(n.code,{children:"amis"})," 的 ",(0,s.jsx)(n.code,{children:"select"})," / ",(0,s.jsx)(n.code,{children:"radios"}),"等选项组件的 ",(0,s.jsx)(n.code,{children:"source"})," 属性实现动态选项"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"添加一条 api 记录"}),"\n",(0,s.jsxs)(n.li,{children:["路由信息将会被注册到 ",(0,s.jsx)(n.code,{children:"routes/admin.php"})," 文件中","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"可以使用 '/admin-api/路径' 来访问你的 api"}),"\n",(0,s.jsx)(n.li,{children:"在其他模块中也可以使用 '/模块-api/路径' 来访问你的 api"}),"\n",(0,s.jsx)(n.li,{children:"如果是在可视化编辑器中使用, 则不需要添加 '/admin-api/' 前缀, 直接填写你保存的路径即可"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"新建-api-模板",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#新建-api-模板",children:"#"}),"新建 api 模板"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["可以在 ",(0,s.jsx)(n.a,{href:"https://github.com/slowlyo/owl-admin/discussions/categories/%E5%8A%A8%E6%80%81-api-%E6%A8%A1%E6%9D%BF",rel:"noopener noreferrer",target:"_blank",children:"GitHub Discussions"})," 中, 获取他人分享的 api 模板"]}),"\n",(0,s.jsxs)(n.li,{children:["手动创建","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["在 ",(0,s.jsx)(n.code,{children:"app/ApiTemplates"})," 目录下创建一个新的类"]}),"\n",(0,s.jsxs)(n.li,{children:["继承 ",(0,s.jsx)(n.code,{children:"Slowlyo\\OwlAdmin\\Support\\Apis\\AdminBaseApi"})," 类, 并实现 ",(0,s.jsx)(n.code,{children:"handle"})," 方法"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"示例:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",meta:"",children:"<?php\n\nnamespace App\\ApiTemplates;\n\nuse Slowlyo\\OwlAdmin\\Support\\Apis\\AdminBaseApi;\n\nclass OptionsApi extends AdminBaseApi\n{\n    // 请求方式\n    public string $method = 'get';\n    \n    // 模板的名称, 方式一\n    public string $title = '获取选项列表';\n\n    // 模板的名称, 方式二\n    public function getTitle()\n    {\n        return '获取选项列表';\n    }\n\n    // api 的处理逻辑\n    public function handle()\n    {\n        // getArgs 方法可以获取到创建的 api 的参数\n        return $this->service()->query()->get([\n            $this->getArgs('value_field') . ' as value',\n            $this->getArgs('label_field') . ' as label'\n        ]);\n    }\n\n    // api 的参数配置, 返回数组格式的 amis 结构\n    // 动态 api 的表单中, 将会把 argsSchema 返回的表单放到 Combo 组件中\n    public function argsSchema()\n    {\n        return [\n            // 让用户选择从哪个模型获取数据\n            amis()->SelectControl('model', __('admin.relationships.model'))\n                ->required()\n                ->menuTpl('${label} <span class=\"text-gray-300 pl-2\">${table}</span>')\n                ->source('/dev_tools/relation/model_options')\n                ->searchable(),\n            amis()->TextControl('value_field', 'Value字段')->required(),\n            amis()->TextControl('label_field', 'Label字段')->required(),\n        ];\n    }\n\n    protected function service()\n    {\n        // blankService 方法由父类提供, 返回了一个空白的 AdminService 实例\n        $service = $this->blankService();\n\n        // 读取参数, 给 service 设置模型\n        $service->setModelName($this->getArgs('model'));\n\n        return $service;\n    }\n}\n"})})]})}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,l.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(r,e)})):r(e)}let c=a;a.__RSPRESS_PAGE_META={},a.__RSPRESS_PAGE_META["guide%2Fbuilt-in%2Fapi.md"]={toc:[{id:"使用",text:"使用",depth:3},{id:"新建-api-模板",text:"新建 api 模板",depth:3}],title:"动态 API",frontmatter:{}}}}]);