"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["3706"],{3147:function(e,n,a){a.r(n),a.d(n,{default:()=>c});var r=a(2676),s=a(453);function i(e){let n=Object.assign({h1:"h1",a:"a",h2:"h2",h3:"h3",p:"p",code:"code",pre:"pre",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,s.ah)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.h1,{id:"扩展配置指南",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#扩展配置指南",children:"#"}),"扩展配置指南"]}),"\n",(0,r.jsxs)(n.h2,{id:"composer-配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#composer-配置",children:"#"}),"Composer 配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"基本配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#基本配置",children:"#"}),"基本配置"]}),"\n",(0,r.jsxs)(n.p,{children:["扩展的 ",(0,r.jsx)(n.code,{children:"composer.json"})," 文件是扩展的核心配置文件："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "name": "vendor/package-name",\n    "type": "library",\n    "description": "扩展描述信息",\n    "version": "1.0.0",\n    "keywords": ["owl-admin", "extension"],\n    "license": "MIT",\n    "authors": [\n        {\n            "name": "作者姓名",\n            "email": "author@example.com",\n            "homepage": "https://example.com"\n        }\n    ],\n    "homepage": "https://github.com/vendor/package-name",\n    "require": {\n        "php": ">=8.1",\n        "slowlyo/owl-admin": "^2.0"\n    },\n    "autoload": {\n        "psr-4": {\n            "Vendor\\\\PackageName\\\\": "src/"\n        }\n    },\n    "extra": {\n        "owl-admin": "Vendor\\\\PackageName\\\\PackageNameServiceProvider",\n        "laravel": {\n            "providers": [\n                "Vendor\\\\PackageName\\\\PackageNameServiceProvider"\n            ]\n        },\n        "alias": "扩展显示名称"\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"重要字段说明",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#重要字段说明",children:"#"}),"重要字段说明"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"字段"}),(0,r.jsx)(n.th,{children:"说明"}),(0,r.jsx)(n.th,{children:"必需"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"name"})}),(0,r.jsxs)(n.td,{children:["扩展包名，格式：",(0,r.jsx)(n.code,{children:"vendor/package-name"})]}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"extra.owl-admin"})}),(0,r.jsx)(n.td,{children:"服务提供者类名"}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"extra.laravel.providers"})}),(0,r.jsx)(n.td,{children:"Laravel 包发现（Composer 安装时用于自动注册 Provider）"}),(0,r.jsx)(n.td,{children:"建议"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"extra.alias"})}),(0,r.jsx)(n.td,{children:"扩展显示名称"}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"description"})}),(0,r.jsx)(n.td,{children:"扩展描述"}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"version"})}),(0,r.jsx)(n.td,{children:"版本号"}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"authors"})}),(0,r.jsx)(n.td,{children:"作者信息"}),(0,r.jsx)(n.td,{children:"✓"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"homepage"})}),(0,r.jsx)(n.td,{children:"扩展主页"}),(0,r.jsx)(n.td,{children:"-"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"keywords"})}),(0,r.jsx)(n.td,{children:"关键词"}),(0,r.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,r.jsxs)(n.h2,{id:"系统配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#系统配置",children:"#"}),"系统配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"扩展目录配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#扩展目录配置",children:"#"}),"扩展目录配置"]}),"\n",(0,r.jsxs)(n.p,{children:["在 ",(0,r.jsx)(n.code,{children:"config/admin.php"})," 中配置扩展安装目录："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"'extension' => [\n    // 扩展安装目录（本地扩展会被扫描加载）\n    'dir' => base_path('extensions'),\n],\n"})}),"\n",(0,r.jsxs)(n.p,{children:["说明：静态资源发布目录为固定路径 ",(0,r.jsx)(n.code,{children:"public/extensions/{package-name}"}),"（见 ",(0,r.jsx)(n.code,{children:"Slowlyo\\OwlAdmin\\Extend\\ServiceProvider::getPublishPath()"}),"），不支持通过配置项自定义。"]}),"\n",(0,r.jsxs)(n.h3,{id:"权限配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#权限配置",children:"#"}),"权限配置"]}),"\n",(0,r.jsx)(n.p,{children:"扩展可以配置无需权限验证的路由："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class PackageNameServiceProvider extends ServiceProvider\n{\n    protected $exceptRoutes = [\n        // 无需权限验证的路由\n        'permission' => [\n            'package-name/public/*',\n            'package-name/api/webhook',\n        ],\n        // 无需登录验证的路由\n        'auth' => [\n            'package-name/webhook',\n            'package-name/callback',\n        ],\n    ];\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"中间件配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#中间件配置",children:"#"}),"中间件配置"]}),"\n",(0,r.jsx)(n.p,{children:"注册扩展专用中间件："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class PackageNameServiceProvider extends ServiceProvider\n{\n    protected $middleware = [\n        'custom' => \\Vendor\\PackageName\\Http\\Middleware\\CustomMiddleware::class,\n        'rate_limit' => \\Vendor\\PackageName\\Http\\Middleware\\RateLimitMiddleware::class,\n    ];\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"扩展设置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#扩展设置",children:"#"}),"扩展设置"]}),"\n",(0,r.jsxs)(n.h3,{id:"设置表单定义",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#设置表单定义",children:"#"}),"设置表单定义"]}),"\n",(0,r.jsx)(n.p,{children:"扩展可以提供配置表单供用户设置："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function settingForm()\n{\n    return $this->baseSettingForm()->body([\n        // 基础配置\n        amis()->GroupControl()->label('基础配置')->body([\n            TextControl::make()\n                ->name('app_name')\n                ->label('应用名称')\n                ->required(true)\n                ->placeholder('请输入应用名称'),\n                \n            TextControl::make()\n                ->name('app_key')\n                ->label('应用密钥')\n                ->required(true)\n                ->type('password'),\n        ]),\n        \n        // 高级配置\n        amis()->GroupControl()->label('高级配置')->body([\n            SwitchControl::make()\n                ->name('debug_mode')\n                ->label('调试模式')\n                ->value(false),\n                \n            NumberControl::make()\n                ->name('timeout')\n                ->label('超时时间（秒）')\n                ->value(30)\n                ->min(1)\n                ->max(300),\n                \n            SelectControl::make()\n                ->name('log_level')\n                ->label('日志级别')\n                ->options([\n                    ['label' => 'DEBUG', 'value' => 'debug'],\n                    ['label' => 'INFO', 'value' => 'info'],\n                    ['label' => 'WARNING', 'value' => 'warning'],\n                    ['label' => 'ERROR', 'value' => 'error'],\n                ])\n                ->value('info'),\n        ]),\n        \n        // 功能开关\n        amis()->GroupControl()->label('功能开关')->body([\n            CheckboxesControl::make()\n                ->name('features')\n                ->label('启用功能')\n                ->options([\n                    ['label' => '自动同步', 'value' => 'auto_sync'],\n                    ['label' => '邮件通知', 'value' => 'email_notify'],\n                    ['label' => '数据缓存', 'value' => 'data_cache'],\n                ])\n                ->value(['auto_sync']),\n        ]),\n    ]);\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"配置验证",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置验证",children:"#"}),"配置验证"]}),"\n",(0,r.jsx)(n.p,{children:"添加配置验证规则："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function settingForm()\n{\n    return $this->baseSettingForm()\n        ->rules([\n            'app_name' => 'required|string|max:50',\n            'app_key' => 'required|string|min:16',\n            'timeout' => 'required|integer|min:1|max:300',\n        ])\n        ->body([\n            // 表单控件...\n        ]);\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"配置使用",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置使用",children:"#"}),"配置使用"]}),"\n",(0,r.jsx)(n.p,{children:"在扩展中获取和使用配置："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class PackageNameController extends AdminController\n{\n    public function index()\n    {\n        // 获取单个配置\n        $appName = PackageNameServiceProvider::setting('app_name');\n        \n        // 获取所有配置\n        $config = PackageNameServiceProvider::setting();\n        \n        // 获取嵌套配置\n        $features = PackageNameServiceProvider::setting('features', []);\n        \n        // 检查功能是否启用\n        $autoSync = in_array('auto_sync', $features);\n        \n        return $this->response()->success([\n            'app_name' => $appName,\n            'auto_sync_enabled' => $autoSync,\n        ]);\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"环境配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#环境配置",children:"#"}),"环境配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"开发环境",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#开发环境",children:"#"}),"开发环境"]}),"\n",(0,r.jsx)(n.p,{children:"在开发环境中启用调试功能："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function customInitAfter()\n{\n    if (app()->environment('local')) {\n        // 开发环境特定配置\n        $this->loadJs('/js/debug.js');\n        \n        // 启用详细日志\n        config(['logging.channels.single.level' => 'debug']);\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"生产环境",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#生产环境",children:"#"}),"生产环境"]}),"\n",(0,r.jsx)(n.p,{children:"生产环境优化配置："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function customInitAfter()\n{\n    if (app()->environment('production')) {\n        // 生产环境优化\n        $this->loadJs('/js/app.min.js');\n        $this->loadCss('/css/app.min.css');\n        \n        // 启用缓存\n        config(['cache.default' => 'redis']);\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"数据库配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#数据库配置",children:"#"}),"数据库配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"迁移文件",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#迁移文件",children:"#"}),"迁移文件"]}),"\n",(0,r.jsxs)(n.p,{children:["扩展的数据库迁移文件放在 ",(0,r.jsx)(n.code,{children:"database/migrations/"})," 目录："]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nuse Illuminate\\Database\\Migrations\\Migration;\nuse Illuminate\\Database\\Schema\\Blueprint;\nuse Illuminate\\Support\\Facades\\Schema;\n\nreturn new class extends Migration\n{\n    public function up()\n    {\n        Schema::create('package_name_items', function (Blueprint $table) {\n            $table->id();\n            $table->string('name');\n            $table->text('description')->nullable();\n            $table->json('config')->nullable();\n            $table->boolean('is_active')->default(true);\n            $table->timestamps();\n            \n            $table->index(['is_active', 'created_at']);\n        });\n    }\n\n    public function down()\n    {\n        Schema::dropIfExists('package_name_items');\n    }\n};\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"模型配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#模型配置",children:"#"}),"模型配置"]}),"\n",(0,r.jsx)(n.p,{children:"创建对应的模型："}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"<?php\n\nnamespace Vendor\\PackageName\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\n\nclass PackageNameItem extends Model\n{\n    protected $fillable = [\n        'name',\n        'description', \n        'config',\n        'is_active',\n    ];\n\n    protected $casts = [\n        'config' => 'array',\n        'is_active' => 'boolean',\n    ];\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"缓存配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#缓存配置",children:"#"}),"缓存配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"配置缓存策略",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#配置缓存策略",children:"#"}),"配置缓存策略"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"class PackageNameServiceProvider extends ServiceProvider\n{\n    public function customInitAfter()\n    {\n        // 配置扩展专用缓存\n        config([\n            'cache.stores.extension_cache' => [\n                'driver' => 'file',\n                'path' => storage_path('framework/cache/extensions/' . $this->getName()),\n            ],\n        ]);\n    }\n    \n    protected function getCacheKey($key)\n    {\n        return $this->getName() . ':' . $key;\n    }\n    \n    public function cacheGet($key, $default = null)\n    {\n        return cache()->store('extension_cache')->get($this->getCacheKey($key), $default);\n    }\n    \n    public function cacheSet($key, $value, $ttl = 3600)\n    {\n        return cache()->store('extension_cache')->put($this->getCacheKey($key), $value, $ttl);\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"日志配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#日志配置",children:"#"}),"日志配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"扩展专用日志",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#扩展专用日志",children:"#"}),"扩展专用日志"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function customInitAfter()\n{\n    // 配置扩展日志通道\n    config([\n        'logging.channels.extension' => [\n            'driver' => 'single',\n            'path' => storage_path('logs/extensions/' . $this->getName() . '.log'),\n            'level' => $this->config('log_level', 'info'),\n        ],\n    ]);\n}\n\nprotected function log($level, $message, $context = [])\n{\n    \\Log::channel('extension')->{$level}($message, $context);\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"安全配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#安全配置",children:"#"}),"安全配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"csrf-保护",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#csrf-保护",children:"#"}),"CSRF 保护"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// 在路由中启用 CSRF 保护\nRoute::middleware(['web', 'admin.auth'])->group(function () {\n    Route::post('package-name/save', [PackageNameController::class, 'save']);\n});\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"输入验证",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#输入验证",children:"#"}),"输入验证"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function save(Request $request)\n{\n    $validated = $request->validate([\n        'name' => 'required|string|max:255',\n        'email' => 'required|email',\n        'config' => 'array',\n    ]);\n    \n    // 处理验证后的数据\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"性能配置",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#性能配置",children:"#"}),"性能配置"]}),"\n",(0,r.jsxs)(n.h3,{id:"资源优化",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#资源优化",children:"#"}),"资源优化"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"public function customInitAfter()\n{\n    // 合并 CSS 文件\n    if (app()->environment('production')) {\n        $this->loadCss('/css/app.min.css');\n    } else {\n        $this->loadCss('/css/app.css');\n        $this->loadCss('/css/debug.css');\n    }\n    \n    // 延迟加载 JS\n    $this->loadJs('/js/app.js', ['defer' => true]);\n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"数据库优化",children:[(0,r.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#数据库优化",children:"#"}),"数据库优化"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",children:"// 在模型中添加索引（与本示例表结构一致）\nSchema::table('package_name_items', function (Blueprint $table) {\n    $table->index(['is_active', 'created_at']);\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"通过合理的配置，可以确保扩展在各种环境下都能稳定高效地运行。"})]})}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,r.jsx)(n,Object.assign({},e,{children:(0,r.jsx)(i,e)})):i(e)}let c=d;d.__RSPRESS_PAGE_META={},d.__RSPRESS_PAGE_META["guide%2Fextension%2Fconfiguration.md"]={toc:[{id:"composer-配置",text:"Composer 配置",depth:2},{id:"基本配置",text:"基本配置",depth:3},{id:"重要字段说明",text:"重要字段说明",depth:3},{id:"系统配置",text:"系统配置",depth:2},{id:"扩展目录配置",text:"扩展目录配置",depth:3},{id:"权限配置",text:"权限配置",depth:3},{id:"中间件配置",text:"中间件配置",depth:3},{id:"扩展设置",text:"扩展设置",depth:2},{id:"设置表单定义",text:"设置表单定义",depth:3},{id:"配置验证",text:"配置验证",depth:3},{id:"配置使用",text:"配置使用",depth:3},{id:"环境配置",text:"环境配置",depth:2},{id:"开发环境",text:"开发环境",depth:3},{id:"生产环境",text:"生产环境",depth:3},{id:"数据库配置",text:"数据库配置",depth:2},{id:"迁移文件",text:"迁移文件",depth:3},{id:"模型配置",text:"模型配置",depth:3},{id:"缓存配置",text:"缓存配置",depth:2},{id:"配置缓存策略",text:"配置缓存策略",depth:3},{id:"日志配置",text:"日志配置",depth:2},{id:"扩展专用日志",text:"扩展专用日志",depth:3},{id:"安全配置",text:"安全配置",depth:2},{id:"csrf-保护",text:"CSRF 保护",depth:3},{id:"输入验证",text:"输入验证",depth:3},{id:"性能配置",text:"性能配置",depth:2},{id:"资源优化",text:"资源优化",depth:3},{id:"数据库优化",text:"数据库优化",depth:3}],title:"扩展配置指南",headingTitle:"扩展配置指南",frontmatter:{}}}}]);