"use strict";(self.webpackChunkrspress_doc_template=self.webpackChunkrspress_doc_template||[]).push([["3674"],{1915:function(e,n,r){r.r(n),r.d(n,{default:function(){return d}});var s=r(2676),t=r(453);function a(e){let n=Object.assign({h1:"h1",a:"a",p:"p",code:"code",div:"div",h2:"h2",pre:"pre",h3:"h3"},(0,t.ah)(),e.components);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.h1,{id:"数据导出",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#数据导出",children:"#"}),"数据导出"]}),"\n",(0,s.jsxs)(n.p,{children:["框架提供了基础的数据导出功能, 可以很方便的实现导出数据到 ",(0,s.jsx)(n.code,{children:".xlsx"})," 文件"]}),"\n",(0,s.jsxs)(n.div,{className:"rspress-directive info",children:[(0,s.jsx)(n.div,{className:"rspress-directive-title",children:"注意"}),(0,s.jsx)(n.div,{className:"rspress-directive-content",children:(0,s.jsxs)(n.p,{children:["\n使用框架默认的导出功能, 你需要先安装 ",(0,s.jsx)(n.a,{href:"https://github.com/rap2hpoutre/fast-excel",rel:"noopener noreferrer",target:"_blank",children:"fast-excel"}),"( rap2hpoutre/fast-excel )"]})})]}),"\n",(0,s.jsxs)(n.h2,{id:"使用",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#使用",children:"#"}),"使用"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",meta:"",children:"// 在列表工具栏添加导出按钮\npublic function list(): Page\n{\n    $crud = $this->baseCRUD()\n        ->headerToolbar([\n            $this->createButton(),\n            ...$this->baseHeaderToolBar(),\n            // 添加导出按钮\n            $this->exportAction(),\n        ])\n        ->columns([\n            // ...\n        ]);\n\n    return $this->baseList($crud);\n}\n\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"自定义导出信息",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#自定义导出信息",children:"#"}),"自定义导出信息"]}),"\n",(0,s.jsxs)(n.h3,{id:"导出文件名",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导出文件名",children:"#"}),"导出文件名"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",meta:"",children:"// 在控制器中重写 exportFileName 方法\nprotected function exportFileName()\n{\n    return '此处为导出文件名';\n}\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"导出列信息",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#导出列信息",children:"#"}),"导出列信息"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",meta:"",children:"// 在控制器中重写 exportMap 方法, $row 是数组格式\n// 该方法会被循环调用, 请不要在里面执行 IO 操作\nprotected function exportMap($row)\n{\n    return [\n        '姓名' => $row['name'],\n        '年龄' => $row['age'],\n        '性别' => $row['gender'],\n        '...'\n    ];\n}\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"完整自定义",children:[(0,s.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#完整自定义",children:"#"}),"完整自定义"]}),"\n",(0,s.jsxs)(n.p,{children:["如果以上配置不能满足你的需求, 你可以重写 ",(0,s.jsx)(n.code,{children:"export"})," 方法, 自定义导出逻辑"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",meta:"",children:"// 在控制器中重写 export 方法\n// 此方法在 index() 中被调用, 当请求参数 _action=export 时\nprotected function export()\n{\n    // 默认在 storage/app/ 下\n    $path = sprintf('%s-%s.xlsx', $this->exportFileName(), date('YmdHis'));\n\n    // 导出本页和导出选中项都是通过 _ids 查询\n    $ids = request()->input('_ids');\n\n    // listQuery() 为列表查询条件，与获取列表数据一致\n    $query = $this->service->listQuery()\n        ->when($ids, fn($query) => $query->whereIn($this->service->primaryKey(), explode(',', $ids)));\n\n    try {\n        fastexcel($query->get())->export(storage_path('app/' . $path), fn($row) => $this->exportMap($row));\n    } catch (\\Throwable $e) {\n        admin_abort(__('admin.action_failed'));\n    }\n\n    return $this->response()->success(compact('path'));\n}\n"})})]})}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,t.ah)(),e.components);return n?(0,s.jsx)(n,Object.assign({},e,{children:(0,s.jsx)(a,e)})):a(e)}let d=i;i.__RSPRESS_PAGE_META={},i.__RSPRESS_PAGE_META["guide%2Fcrud%2Fexport.md"]={toc:[{id:"使用",text:"使用",depth:2},{id:"自定义导出信息",text:"自定义导出信息",depth:2},{id:"导出文件名",text:"导出文件名",depth:3},{id:"导出列信息",text:"导出列信息",depth:3},{id:"完整自定义",text:"完整自定义",depth:2}],title:"数据导出",frontmatter:{}}}}]);